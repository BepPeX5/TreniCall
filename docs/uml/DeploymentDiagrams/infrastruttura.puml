@startuml
!theme plain
title TreniCal - Deployment Diagram: Infrastruttura Sistema

node "Development Environment" {
    node "Client Workstation" {
        artifact "trenicall-client.jar" as CLIENT_JAR
        artifact "trenicall-admin.jar" as ADMIN_JAR
        component "Swing Client GUI" as CLIENT_APP
        component "Admin Console GUI" as ADMIN_APP
        CLIENT_JAR --> CLIENT_APP
        ADMIN_JAR --> ADMIN_APP
    }

    node "Server Machine" {
        artifact "trenicall-server.jar" as SERVER_JAR
        component "Spring Boot Application" as SPRING_APP
        component "File System" as FS
        SERVER_JAR --> SPRING_APP
        SPRING_APP --> FS
    }

    node "Database Server" {
        database "MySQL 8.0" as MYSQL
        database "Redis Cache" as REDIS
    }
}

node "Test Environment" {
    node "Test Runner" {
        artifact "Test Classes" as TEST_CLASSES
        component "Unit Tests" as UNIT_TESTS
        component "Integration Tests" as INTEGRATION_TESTS
        component "End-to-End gRPC Tests" as E2E_TESTS
        TEST_CLASSES --> UNIT_TESTS
        TEST_CLASSES --> INTEGRATION_TESTS
        TEST_CLASSES --> E2E_TESTS
    }

    node "Test Database" {
        database "H2 In-Memory" as H2_DB
        component "TestDataConfiguration" as TEST_DATA
        TEST_DATA --> H2_DB
    }

    node "Test gRPC Server" {
        component "GrpcServerTestConfiguration" as TEST_GRPC
    }
}

node "Docker Environment" {
    node "Docker Host" {
        node "MySQL Container" {
            database "mysql:8.0" as DOCKER_MYSQL
        }
        node "Redis Container" {
            database "redis:alpine" as DOCKER_REDIS
        }
        artifact "docker-compose.yml" as COMPOSE_FILE
        COMPOSE_FILE --> DOCKER_MYSQL
        COMPOSE_FILE --> DOCKER_REDIS
    }
}

CLIENT_APP --> SPRING_APP : gRPC/HTTP2
ADMIN_APP --> FS : File Write
SPRING_APP --> MYSQL : JDBC
SPRING_APP --> REDIS : Redis Protocol

@enduml